# Dockerを完全に理解する


こんにちは、しぶやです。\
学生時代の研究から始まり、社会人になってからも愛用しているDockerについて、気合をいれてまとめようと思います。

## TL;DR

*
*
*

## 0　はじめに

### 0.1　コンテナの歴史

コンテナ技術の初期段階として、2008年ごろLXC（Linux Container）が登場しました。
LXCは、2000年代に入ってLinuxに導入されたNamespaceやCgroupsを利用した軽量なコンテナ環境を提供するものです。

その後、2013年ごろ、Dockerが登場し、コンテナ技術が広く知られるようになりました。
DockerはLXCをもとに、コンテナの作成、管理、デプロイを非常に簡単にするツールとして登場しました。
Dockerの登場により、コンテナは非常に使いやすいものとなり、仮想マシンに代わる新しい標準として急速に普及しました。

※ Dockerはあくまでコンテナを管理するためのツールであり、Docker=コンテナではないです。

公式ではDockerを以下のように説明しています。
> Docker は、アプリケーションの開発、出荷、実行の方法に革命をもたらした包括的なプラットフォームとツールスイートを提供します。
> コンテナ化の概念に基づいて構築されており、コンテナの代名詞になるほど単純化されています。

近年はKubernetesにより大規模な分散システムの基盤として使用されたり、サーバーレスコンピューティングに応用されていたりします。

### 0.2　VMとの違い

VMとコンテナの違いはよく聞く話だと思います。
[よくある説明](https://www.redhat.com/ja/topics/containers/containers-vs-vms)は、ホストOS上に新たにOSを乗せるているかとホストOS上にコンテナとして隔離されたアプリケーションを乗せているかです。

この説明の通り、**VMとコンテナの違いはホストのカーネルを共有するか**です。
VMはホストOS上でカーネルを仮想化を行います。
一方で、コンテナはホストのカーネルを共有し、リソースなどを分離します。

これにより、コンテナは**軽量なアプリケーションの実行環境**を実現します。

## 1　コンテナの仕組み

コンテナにはいくつかの欠かせない要素技術があります。
本章では、コンテナの本質を理解するために、それらの要素技術について学習しようと思います。

### 1.1　namespace

### 1.2　cgroup

### 1.3　chroot/rootfs

### 1.4　コンテナの本質

コンテナはプロセス。
initプロセスとPID
ホストから見たとき

## 2　Dockerイメージ

### 2.1　Docker Hub

[Docker Hub](https://www.docker.com/ja-jp/products/docker-hub/)はコンテナ化されたアプリを簡単に保存、管理、デプロイするためのプラットフォームです。
Docker Hubの機能には以下のようなものがあります。
* 無制限のパブリックリポジトリ...無制限のパブリックなリポジトリを利用できます。誰かが作成したカスタムイメージなどもすぐに利用できます。
* プライベート リポジトリ...プライベートリポジトリを作成し、イメージへのアクセス制御を行うことができます。
* 効率的なイメージアクセス...
* Webhook
* 自動テスト
* GitHubとBitbucketの統合
* 同時ビルドと自動ビルド

### 2.2　イメージの構成

Layerの階層構造
再利用性
Union FS


### 2.3　最小化

scratch, Alpine, distroless
思想
attack surfaceの削減
運用

## 3　コンテナセキュリティ

### 3.1　capability

capabilities

seccomp, AppArmor, SELinux

### 3.2　コンテナroot

コンテナ内のrootは？
ユーザ変える必要ある？
--privileged

### 3.3　イメージ

信頼性
Docker Content Trust

## 4　Dockerのユースケースとアーキテクチャ

### 4.1　CI/CD


### 4.2　Kubernetes

### 4.3　環境統一


## 5　Dockerのメリット/デメリット

### 5.1　メリット

環境構築の迅速化
環境の再現性と移植性
リソースの軽量性
ホストを汚さない
アタックサーフェスの削減

### 5.2　デメリット

セキュリティ境界の脆弱性
ホスト依存の可能性
オーバーヘッド

## 6　まとめ


## 参考

[1] [docker](https://www.docker.com/)
[2] [コンテナセキュリティ　コンテナ化されたアプリケーションを保護する要素技術 ](https://www.amazon.co.jp/%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BF%9D%E8%AD%B7%E3%81%99%E3%82%8B%E8%A6%81%E7%B4%A0%E6%8A%80%E8%A1%93-Liz-Rice/dp/4295016403)
[3] [コンテナと VM](https://www.redhat.com/ja/topics/containers/containers-vs-vms)
[4] [docker hub](https://hub.docker.com/)
[5] [docker hub クラウドネイティブなソフトウェアの導入を簡単に](https://www.docker.com/ja-jp/products/docker-hub/)
[6] [dockerが使うUnionFileSystemを僕なりに解釈した](https://namu-r21.hatenablog.com/entry/2016/10/27/013006)
[7] []()
[8] []()
[9] []()

